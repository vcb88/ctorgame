# Упрощение системы событий и сообщений

## Изменения в системе событий

1. Упрощена структура событий:
   - Базовые метаданные вынесены в отдельный тип `EventMeta`
   - Заменены интерфейсы на типы
   - Упрощены payload'ы событий
   - Объединены похожие события

До:
```typescript
export interface IGameCreatedEvent extends IBaseEvent {
    readonly type: 'game_created';
    readonly data: {
        readonly gameId: string;
        readonly status: GameStatus;
        readonly createdAt: number;
    };
}
```

После:
```typescript
type GameCreatedPayload = {
    status: 'waiting';
};

type GameEvent = EventMeta & {
    type: 'game_created';
    data: GameCreatedPayload;
};
```

2. Упрощена валидация событий:
   - Одна общая функция валидации
   - Упрощены проверки типов
   - Удалены избыточные валидаторы

## Изменения в обработке ошибок

1. Упрощена система кодов ошибок:
   - Введена категоризация через префиксы
   - Удалены избыточные уровни severity
   - Упрощена структура ошибок

До:
```typescript
export interface INetworkError {
    readonly code: ErrorCode;
    readonly message: string;
    readonly severity: ErrorSeverity;
    readonly recoverable?: boolean;
    readonly retryCount?: number;
    readonly timestamp?: number;
    readonly details?: Record<string, unknown>;
}
```

После:
```typescript
export type GameError = {
    code: ErrorCode;
    message: string;
    details?: Record<string, unknown>;
};
```

2. Улучшена организация кодов ошибок:
   - Структурированные коды с категориями
   - Встроенная информация о типе ошибки в код
   - Упрощенная обработка ошибок

Пример кодов ошибок:
```typescript
export type ErrorCode =
    | 'ERR_100_CONNECTION_ERROR'
    | 'ERR_200_GAME_NOT_FOUND'
    | 'ERR_300_STORAGE_ERROR';
```

3. Упрощена конфигурация восстановления:
   - Меньше параметров
   - Предустановленные значения
   - Простые хелперы для определения типа ошибки

## Преимущества изменений

1. Упрощение кода:
   - Меньше типов и интерфейсов
   - Более плоская структура данных
   - Меньше вложенности

2. Улучшение читаемости:
   - Более понятная структура событий
   - Самодокументируемые коды ошибок
   - Упрощенная обработка ошибок

3. Производительность:
   - Меньше памяти на метаданные
   - Проще сериализация/десериализация
   - Быстрее валидация

## Технический долг

1. Требуется обновление:
   - Клиентского кода для работы с новыми ошибками
   - Серверных обработчиков событий
   - Тестов на новые форматы

2. Возможные проблемы:
   - Совместимость со старыми форматами логов
   - Миграция существующих обработчиков ошибок
   - Обновление документации API

## Следующие шаги

1. Обновить обработчики событий на сервере
2. Обновить клиентский код
3. Актуализировать тесты
4. Обновить документацию API
5. Мигрировать существующие логи